<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inside the Fort</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="github_test.css" />
</head>

<body>
  <header>
    <h1>🛖🛝 Inside the Fort 😀🐨</h1>
    <p>A podcast with Alfie and friends.</p>
    <!--h1>...</h1-->
  </header>

  <main id="episode-container">
	<!-- Episodes will be loaded here -->
  </main>
    
  <footer>
    <p>© 2025 The Inside the Fort Podcast — Made with 🤖 + ❤️</p>
  </footer>

  <!-- JavaScript -->
<script>
fetch("episodes.json")
  .then(res => res.json())
  .then(episodes => {
    const container = document.getElementById("episode-container");
    const grouped = {};

    // Group episodes by year
    episodes.forEach(ep => {
      if (!grouped[ep.year]) grouped[ep.year] = [];
      grouped[ep.year].push(ep);
    });

    // Sort years (newest first)
    const years = Object.keys(grouped).sort((a, b) => b - a);

    years.forEach(year => {
      const yearGroup = document.createElement("div");
      yearGroup.classList.add("year-group");

      const btn = document.createElement("button");
      btn.classList.add("year-btn");
      btn.textContent = year;

      const episodesDiv = document.createElement("div");
      episodesDiv.classList.add("episodes");

      // Sort newest episodes first by title number (#03, #02, etc.)
      grouped[year].sort((a, b) => {
        const numA = parseInt(a.title.match(/#(\d+)/)?.[1] || 0);
        const numB = parseInt(b.title.match(/#(\d+)/)?.[1] || 0);
        return numB - numA;
      });

      const episodeCard = document.createElement("div");
      episodeCard.classList.add("episode-card");

      grouped[year].forEach((ep, i) => {
        episodeCard.innerHTML += `
          <div class="episode">
            <img src="${ep.image}" alt="${ep.title} cover" class="cover">
            <div class="content">
              <h2>${ep.title}</h2>
              <p class="desc">${ep.description}</p>
              <div class="meta">
                <span class="release-date">${ep.date}</span> • 
                <span class="duration">${ep.duration}</span>
              </div>
            </div>
            <div class="status-container">
              <div class="status-dot new"></div>
            </div>
          </div>
          ${i < grouped[year].length - 1 ? '<hr class="episode-divider">' : ''}
        `;
      });

      episodesDiv.appendChild(episodeCard);
      yearGroup.appendChild(btn);
      yearGroup.appendChild(episodesDiv);
      container.appendChild(yearGroup);
    });

    // Collapsible years
    document.querySelectorAll('.year-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const yearGroup = btn.closest('.year-group');
        const episodesDiv = btn.nextElementSibling;
        const isHidden = episodesDiv.style.display === 'none';
        episodesDiv.style.display = isHidden ? 'block' : 'none';
        yearGroup.classList.toggle('collapsed', !isHidden);
      });
    });
  })
  .catch(err => console.error("Error loading episodes:", err));
</script>

</body>
</html>
