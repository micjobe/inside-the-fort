<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inside the Fort</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="github_test.css" />
</head>

<body>
  <header>
    <h1>🛖🛝 Inside the Fort 😀🐨</h1>
    <p>A podcast with Alfie and friends.</p>
    <!--h1>...</h1-->
  </header>

  <main id="episode-container">
	<!-- Episodes will be loaded here -->
  </main>
    
  <footer>
    <p>© 2025 The Inside the Fort Podcast — Made with 🤖 + ❤️</p>
  </footer>

  <!-- JavaScript -->
<script>
fetch("episodes.json")
  .then(res => res.json())
  .then(episodes => {
    const container = document.getElementById("episode-container");
    const grouped = {};

    // Group episodes by year
    episodes.forEach(ep => {
      if (!grouped[ep.year]) grouped[ep.year] = [];
      grouped[ep.year].push(ep);
    });

    // Sort years descending
    const years = Object.keys(grouped).sort((a, b) => b - a);

    years.forEach(year => {
      // Sort episodes newest-first based on number in title
      grouped[year].sort((a, b) => {
        const numA = parseInt(a.title.match(/^#(\d+)/)[1], 10);
        const numB = parseInt(b.title.match(/^#(\d+)/)[1], 10);
        return numB - numA;
      });

      const yearGroup = document.createElement("div");
      yearGroup.classList.add("year-group");

      const btn = document.createElement("button");
      btn.classList.add("year-btn");
      btn.textContent = year;

      const epDiv = document.createElement("div");
      epDiv.classList.add("episodes");

      grouped[year].forEach(ep => {
        epDiv.innerHTML += `
          <section class="episode" data-year="${ep.year}">
            <img src="${ep.image}" alt="${ep.title} cover" class="cover">
            <div class="content">
              <h2>${ep.title}</h2>
              <p class="desc">${ep.description}</p>
              ${ep.date ? `<div class="meta"><span class="release-date">${ep.date}</span> • <span class="duration">${ep.duration || ''}</span></div>` : ''}
            </div>
            <div class="play-btn" data-episode="${ep.audio}">
              <svg class="icon play" viewBox="0 0 100 100" width="28" height="28" fill="white">
                <polygon points="35,25 75,50 35,75"/>
              </svg>
              <svg class="icon pause" viewBox="0 0 100 100" width="28" height="28" fill="white">
                <rect x="35" y="25" width="10" height="50"/>
                <rect x="55" y="25" width="10" height="50"/>
              </svg>
            </div>
          </section>
        `;
      });

      yearGroup.appendChild(btn);
      yearGroup.appendChild(epDiv);
      container.appendChild(yearGroup);
    });
  })
  .then(() => {
    // Play/pause button logic
    const player = new Audio();
    document.querySelectorAll('.play-btn').forEach(btn => {
      const playIcon = btn.querySelector('.icon.play');
      const pauseIcon = btn.querySelector('.icon.pause');
      pauseIcon.style.display = 'none';

      btn.addEventListener('click', () => {
        const src = btn.getAttribute('data-episode');
        if (player.src.includes(src) && !player.paused) {
          player.pause();
          playIcon.style.display = 'block';
          pauseIcon.style.display = 'none';
        } else {
          document.querySelectorAll('.play-btn').forEach(b => {
            b.querySelector('.icon.play').style.display = 'block';
            b.querySelector('.icon.pause').style.display = 'none';
          });
          player.src = src;
          player.play();
          playIcon.style.display = 'none';
          pauseIcon.style.display = 'block';
        }
      });
    });

    // Collapsible years
    document.querySelectorAll('.year-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const episodesDiv = btn.nextElementSibling;
        const isHidden = episodesDiv.style.display === 'none';
        episodesDiv.style.display = isHidden ? 'block' : 'none';
      });
    });
  })
  .catch(err => console.error("Error loading episodes:", err));
</script>

</body>
</html>

