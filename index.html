<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inside the Fort</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="github_test.css" />
</head>

<body>
  <header>
    <h1>🛖🛝 Inside the Fort 😀🐨</h1>
    <p>A podcast with Alfie and friends.</p>
    <!--h1>...</h1-->
  </header>

  <main id="episode-container">
	<!-- Episodes will be loaded here -->
  </main>
    
  <footer>
    <p>© 2025 The Inside the Fort Podcast — Made with 🤖 + ❤️</p>
  </footer>

  <!-- JavaScript -->
<script>
fetch("episodes.json")
  .then(res => res.json())
  .then(episodes => {
    const container = document.getElementById("episode-container");
    const grouped = {};

    // Group episodes by year
    episodes.forEach(ep => {
      if (!grouped[ep.year]) grouped[ep.year] = [];
      grouped[ep.year].push(ep);
    });

    // Sort years (newest first)
    const years = Object.keys(grouped).sort((a, b) => b - a);

    years.forEach(year => {
      const yearGroup = document.createElement("div");
      yearGroup.classList.add("year-group");

      const btn = document.createElement("button");
      btn.classList.add("year-btn");
      btn.textContent = year;

      const episodesDiv = document.createElement("div");
      episodesDiv.classList.add("episodes");

      // Sort: if release_date exists, use it. Otherwise, fallback to episode number.
      grouped[year].sort((a, b) => {
        if (a.release_date && b.release_date) {
          return new Date(b.release_date) - new Date(a.release_date);
        }
        const numA = parseInt(a.number || a.title.match(/#?(\d+)/)?.[1] || 0);
        const numB = parseInt(b.number || b.title.match(/#?(\d+)/)?.[1] || 0);
        return numB - numA;
      });

      const episodeCard = document.createElement("div");
      episodeCard.classList.add("episode-card");

      grouped[year].forEach((ep, i) => {
        const episode = document.createElement("div");
        episode.classList.add("episode");

        episode.innerHTML = `
          <img src="${ep.image}" alt="${ep.title} cover" class="cover">
          <div class="content">
            <div class="meta top">
              <span class="episode-number">EPISODE ${String(ep.number).padStart(2, '0')}</span>
            </div>
            <h2>${ep.title}</h2>
            <p class="desc">${ep.description}</p>
            <div class="meta bottom">
              <span class="duration">(${ep.duration})</span>
            </div>
          </div>
          <div class="status-container">
            <div class="status-dot new"></div>
          </div>
        `;

        // Optional hidden release date (kept for sorting, not shown)
        if (ep.release_date) {
          const hiddenDate = document.createElement("span");
          hiddenDate.classList.add("release-date");
          hiddenDate.style.display = "none";
          hiddenDate.textContent = ep.release_date;
          episode.appendChild(hiddenDate);
        }

        episodeCard.appendChild(episode);

        if (i < grouped[year].length - 1) {
          const divider = document.createElement("hr");
          divider.classList.add("episode-divider");
          episodeCard.appendChild(divider);
        }
      });

      episodesDiv.appendChild(episodeCard);
      yearGroup.appendChild(btn);
      yearGroup.appendChild(episodesDiv);
      container.appendChild(yearGroup);
    });

    // Collapsible years
    document.querySelectorAll('.year-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const yearGroup = btn.closest('.year-group');
        const episodesDiv = btn.nextElementSibling;
        const isHidden = episodesDiv.style.display === 'none';
        episodesDiv.style.display = isHidden ? 'block' : 'none';
        yearGroup.classList.toggle('collapsed', !isHidden);
      });
    });
  })
  .catch(err => console.error("Error loading episodes:", err));
</script>
</body>
</html>

